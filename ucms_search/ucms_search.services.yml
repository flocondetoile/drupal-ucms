parameters:

  # Elastic client configuration, see ElasticSearch\ClientBuilder::fromConfig()
  # factory method doc for extended information about client parameters and
  # behaviors
  ucms_search.elastic.config:
    hosts: ["localhost:9200"]

services:

  ucms_search.index_storage:
    class: MakinaCorpus\Ucms\Search\IndexStorage
    arguments: ["@ucms_search.elastic.client", "@database", "@ucms_search.node_indexer", "@cache.default", "@module_handler"]

  ucms_search.node_indexer:
    class: MakinaCorpus\Ucms\Search\NodeIndexer
    arguments: ["@ucms_search.elastic.client", "@database", "@entity.manager", "@module_handler"]

  ucms_search.elastic.client:
    class: Elasticsearch\Client
    factory: [Elasticsearch\ClientBuilder, fromConfig]
    arguments: ["%ucms_search.elastic.config%"]

  ucms_search.mapping.type_registry:
    class: MakinaCorpus\Ucms\Search\Mapping\TypeRegistry

  ucms_search.mapping.date:
    public: false
    class: MakinaCorpus\Ucms\Search\Mapping\DateType
    arguments: ["date"]
    tags: [{ name: ucms_search.mapping.type }]

  ucms_search.mapping.integer:
    public: false
    class: MakinaCorpus\Ucms\Search\Mapping\IntegerType
    arguments: ["integer"]
    tags: [{ name: ucms_search.mapping.type }]

  ucms_search.mapping.long:
    public: false
    class: MakinaCorpus\Ucms\Search\Mapping\LongType
    arguments: ["long"]
    tags: [{ name: ucms_search.mapping.type }]

  ucms_search.mapping.string:
    public: false
    class: MakinaCorpus\Ucms\Search\Mapping\StringType
    arguments: ["string"]
    tags: [{ name: ucms_search.mapping.type }]

services:

  ucms_layout.storage:
    # public: false
    # FIXME This is being used by a few unit tests, but this should be private
    class: MakinaCorpus\Ucms\Layout\DrupalStorage
    arguments: ["@database"]

  ucms_layout.storage.temporary:
    public: false
    class: MakinaCorpus\Ucms\Layout\TemporaryStorage
    arguments: ["@database"]

  ucms_layout.context_manager:
    class: MakinaCorpus\Ucms\Layout\ContextManager
    arguments: ["@ucms_layout.storage", "@ucms_layout.storage.temporary", "@ucms_site.manager"]

  ucms_layout.site_event_listener:
    class: MakinaCorpus\Ucms\Layout\EventDispatcher\SiteEventListener
    arguments: ["@database", "@ucms_layout.context_manager", "@ucms_site.manager", "@entity.manager", "@request_stack"]
    tags:
      - {name: event_listener, event: "site:init"}
      - {name: event_listener, event: "site:clone"}
      - {name: event_listener, event: "site:ref"}

  ucms_layout.context_pane_event_listener:
    class: MakinaCorpus\Ucms\Layout\EventDispatcher\ContextPaneEventListener
    arguments: ["@ucms_site.manager", "@ucms_layout.context_manager"]
    tags:
      - {name: event_listener, event: ucms_dashboard.context_init }

  ucms_layout.drop.region_handler:
    public: true
    class: MakinaCorpus\Ucms\Layout\Drop\RegionDropHandler
    arguments: ['@entity.manager', '@ucms_layout.context_manager']
    tags: [{ name: ucms_drop.droppable, type: region }]
